---
title: "Kinesis"
excerpt: ""
---
## Overview
This topic explains how to create and test a Kinesis destination for data export.

You can export all of the flag evaluation and event data generated by LaunchDarkly SDKs to a Kinesis data stream. 
## Prerequisites
To set up a Kinesis destination, you must configure your AWS account with the following information:
- A Kinesis stream you want to export the data to. You can use an existing stream if you already have one.
- An IAM policy that can put records into your Kinesis stream
- An IAM role that LaunchDarkly can assume that provides access to the policy

If you don't already have a Kinesis stream, create one by reading [Amazon's documentation](https://console.aws.amazon.com/kinesis/home#/initial-start).
<Callout intent="info">
  <Callout.Title>Recommended shard count</Callout.Title>
   <Callout.Description>As a best practice, we recommend that you use **1 shard for every 50 million events you send us a month**. 
This recommendation is an estimate based on typical usage patterns, not a requirement. To prevent performance degradation, adjust your shard count based on your actual usage at peak times. If you expect to see usage spikes, provision more shards. If you do not use enough shards for the load, AWS may throttle your data stream. IF this happens, you may experience data loss.</Callout.Description>
</Callout>

## Creating the IAM Policy
This section explains how to create an IAM policy to support the Kinesis data export.
<Callout intent="info">
  <Callout.Title>Save this information</Callout.Title>
  <Callout.Description>If you create a new Kinesis stream, write down or save the following information:
* _Region_\n* _Stream name_ \n* _Stream ARN_
You will need this information when you configure your export.</Callout.Description>

</Callout>

1. Sign in to the [Identity and Access Management (IAM) console](https://console.aws.amazon.com/iam/).
2. Follow [Amazon's documentation](http://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_create.html) to create an IAM policy that allows LaunchDarkly to write to your Kinesis Stream. 
3. Select the **Create Policy from JSON** option.
4. Use the following template policy to configure the Policy Document field.
[block:code]
{
  "codes": [
    {
      "code": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": [\n          \"kinesis:PutRecord\",\n          \"kinesis:PutRecords\"\n      ],\n      \"Resource\": [\n          \"arn:aws:kinesis:{region}:{account-id}:stream/{stream-name}\"\n      ]\n    }\n  ]\n}",
      "language": "json"
    }
  ]
}
[/block]
5. If you have a _stream ARN_ already configured, you can paste the entire ARN in. At least, change the following fields to include the values you specified during IAM policy configuration:
 * `{region}` 
 * `{account-id}` 
 * `{stream-name}`. 
6. Click **Save**.
7. After you create the policy, write down or save the policy's name.
## Creating an IAM Role
This section explains how to create a cross-account IAM role for LaunchDarkly to assume so it can access the policy.


1. Log into AWS and [access the IAM section](https://console.aws.amazon.com/iam/home#/roles$new?step=type&roleType=crossAccount). 
2. In the Account ID section, enter `554582317989` as shown in the image below. This allows LaunchDarkly to assume the role.
[block:image]
{
  "images": [
    {
      "image": [
        "https://files.readme.io/ae0152a-Screen_Shot_2018-11-27_at_9.32.15_AM.png",
        "Screen Shot 2018-11-27 at 9.32.
1. AM.png",
        990,
        488,
        "#f7f8f9"
      ],
      "caption": "Create a role in AWS IAM for LaunchDarkly to assume."
    }
  ]
}
[/block]
3. Add the policy you created earlier to this role. Write down or save the _role ARN_.
<Callout intent="alert">
  <Callout.Title>Restricting trust</Callout.Title>
   <Callout.Description>It's safe and straightforward to set up the role as described above, but your organization may have security requirements limiting what kind of roles you can trust. 
If your organization's security policies require you to trust a specific role, we've provided `arn:aws:iam::554582317989:role/LaunchDarkly-data-export` for you to trust instead. 
This role can only be assumed by our Data Export services (no humans). You can trust our role by following a [procedure in Amazon's documentation](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_manage_modify.html#roles-managingrole-editing-console). When you complete that procedure, set the `Principal` in the trust relationship to `{\"Principal\": { \"AWS\": [\"arn:aws:iam::554582317989:role/LaunchDarkly-data-export\"] }` after you've created a role.</Callout.Description>
</Callout>

## Creating the Kinesis Destination in LaunchDarkly

With the _region_, _stream name_ and _role ARN_ from earlier in the procedure, you can now create the Kinesis destination within LaunchDarkly. 


1. Navigate to the [integrations page](https://app.launchdarkly.com/default/integrations). 
2. Click on the Kinesis icon or, if this is not your first destination, click the **Add Destination** drop down.
[block:image]
{
  "images": [
    {
      "image": [
        "https://files.readme.io/006dc17-Screen_Shot_2018-11-28_at_1.59.06_PM.png",
        "Screen Shot 2018-11-28 at 1.59.06 PM.png",
        1680,
        914,
        "#dddddc"
      ],
      "caption": "add a Kinesis destination by clicking on the Kinesis icon if this is your first destination or by using the add destination drop down."
    }
  ]
}
[/block]
3. Enter a **Name** for the destination.
4. Choose an **Environment** from the drop-down list.
5. Enter the AWS data you saved earlier:
 * AWS Kinesis stream region
 * ROle address
 * AWS Kinesis stream name
6. Click **Save**.
[block:image]
{
  "images": [
    {
      "image": [
        "https://files.readme.io/7fa1bd0-Screen_Shot_2018-11-27_at_5.02.32_PM.png",
        "Screen Shot 2018-11-27 at 5.02.32 PM.png",
        1441,
        961,
        "#b2b2b0"
      ],
      "caption": "A Kinesis destination with AWS information, a name and environment selected."
    }
  ]
}
[/block]

## Testing the Kinesis Destination
After you've saved the destination, send a test event to confirm that the destination is configured properly.


1. In the *Send a test event* section, click **Send Event**.

[block:image]
{
  "images": [
    {
      "image": [
        "https://files.readme.io/1e455ec-Screen_Shot_2018-11-28_at_1.57.22_PM.png",
        "Screen Shot 2018-11-28 at 1.57.22 PM.png",
        1680,
        914,
        "#adacad"
      ],
      "caption": "Send a test event after saving the destination."
    }
  ]
}
[/block]
2. If you have configured the destination correctly, an event is logged in the Kinesis destination. 
3. Identify a successful test event by searching for the user or flag key `LaunchDarklyDataExportTestEvent`. When this key appears in the destination, you know the test event arrived.
<Callout intent="info">
  <Callout.Title>Partition Keys</Callout.Title>
   <Callout.Description>Kinesis records have [partition keys](https://docs.aws.amazon.com/streams/latest/dev/key-concepts.html#partition-key). When we create a record, we use the user key that was sent with the event as the partition key. If the event does not contain a user key, we create a random partition key.</Callout.Description>
</Callout>

## Consuming the Kinesis Data Stream
Kinesis Data Streams are very flexible. You can consume them in a lambda function, write an application to consume the streams, and use a number of pre-built AWS integrations. 

A common use case is to use the Data Stream to populate a data store, such as S3 or Redshift, by setting the Kinesis Data Stream as a source to a Kinesis Data Firehose. To learn how to do this, read [Amazon's documentation](https://docs.aws.amazon.com/firehose/latest/dev/writing-with-kinesis-streams.html).
## Enabling data export for flags and environments
After you create a data export destination, you must start sending flag or environment event data to it. You can enable data export for individual flags, or for all the flags in an environment.

To learn more about exporting event data from flags and environments, read [Exporting event data for flags and environments](./data-export#exporting-event-data-for-flags-and-environments).
## Deleting a Kinesis destination
You can delete a data export destination from the **Integrations** screen.

To delete a destination:

1. Navigate to the **Integrations** screen.
2. Find the destination you wish to delete and click **Edit**. The "Create a destination" screen opens.
3. Click **Delete Destination**.
[block:image]
{
  "images": [
    {
      "image": [
        "https://files.readme.io/83e1d5a-Screen_Shot_2019-07-10_at_11.02.00_AM.png",
        "Screen Shot 2019-07-
1. at 11.02.00 AM.png",
        359,
        141,
        "#f7f6f6"
      ],
      "caption": "The Delete destination section."
    }
  ]
}
[/block]